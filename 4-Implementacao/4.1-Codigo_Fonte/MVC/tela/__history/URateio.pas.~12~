unit URateio;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Mask, Data.DB,
  Datasnap.DBClient, Vcl.Grids, Vcl.DBGrids, Vcl.Buttons, Vcl.ExtCtrls, URateioController, UItensRateioController,
  UEmpresaTrab,UUnidadeController, UUnidadeVO,Generics.Collections;

type
  TFTelaCadastroRateio = class(TForm)
    Panel1: TPanel;
    BitBtnIncluirC: TBitBtn;
    BtnCancelarC: TBitBtn;
    GridLeitura: TDBGrid;
    BitBtnAltera: TBitBtn;
    CDSRateio: TClientDataSet;
    DSRateio: TDataSource;
    CDSRateioIDRATEIO: TIntegerField;
    CDSRateioTOTALRATEIO: TCurrencyField;
    CDSRateioDTRATEIO: TDateTimeField;
    CDSRateioIDCONDOMINIO: TIntegerField;
    MaskEdit1: TMaskEdit;
    Edit3: TEdit;
    CDSItensRateio: TClientDataSet;
    DSItensRateio: TDataSource;
    CDSItensRateioIDITENSRATEIO: TIntegerField;
    CDSItensRateioIDRATEIO: TIntegerField;
    CDSItensRateioIDUNIDADE: TIntegerField;
    CDSItensRateioVLRATEIO: TCurrencyField;
    CDSItensRateioVLFUNDORESERVA: TCurrencyField;
    CDSItensRateioDTRATEIO: TDateTimeField;
    CDSItensRateioDSUNIDADE: TStringField;
    CDSItensRateioVLAREATOTAL: TCurrencyField;
    Panel4: TPanel;
    GroupBox1: TGroupBox;
    Label2: TLabel;
    Label4: TLabel;
    Edit2: TEdit;
    Edit1: TEdit;
    Edit4: TEdit;
    DBGrid2: TDBGrid;
    BitBtn5: TBitBtn;
    BitBtn6: TBitBtn;
    Label1: TLabel;
    Edit5: TEdit;
    Label5: TLabel;
    procedure FormCreate(Sender: TObject);
    procedure BitBtnAlteraClick(Sender: TObject);
    procedure BitBtnIncluirCClick(Sender: TObject);
    procedure BitBtn6Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FTelaCadastroRateio: TFTelaCadastroRateio;
  ControllerRateio : TRateioController;
  ControllerItensRateio : TItensRateioController;

implementation

{$R *.dfm}

procedure TFTelaCadastroRateio.BitBtn6Click(Sender: TObject);
begin
  Panel4.Visible :=false;
  //AtualizaGrid;
end;

procedure TFTelaCadastroRateio.BitBtnAlteraClick(Sender: TObject);
var
  unidadeController : TUnidadeController;
  unidades : TObjectList<TUnidadeVO>;
  i : integer;
begin

  UnidadeController := TUnidadeController.Create;
  Unidades := UnidadeController.Consultar('idcondominio = '+ IntToStr(FormEmpresaTrAB.CodigoEmpLogada));
  CdsItensRateio.EmptyDataSet;
  CdsItensRateio.Open;

  for I := 0  to Unidades.Count - 1 do
  begin
    CdsItensRateio.Append;
    CDSItensRateioDSUNIDADE.AsString := Unidades[i].DsUnidade;

 //   CDSItensRateioVLAREATOTAL :=
    CdsItensRateio.Post;
  end;
  Panel4.Visible := true;
  MaskEdit1.Enabled := true;
  DBGrid2.Enabled := true;
  BitBtn5.Enabled := true;
  UnidadeController.Free;
end;

procedure TFTelaCadastroRateio.BitBtnIncluirCClick(Sender: TObject);
begin
  MaskEdit1.Enabled := true;
  MaskEdit1.SetFocus;
  Edit1.Enabled := true;
end;

procedure TFTelaCadastroRateio.FormCreate(Sender: TObject);
begin
  ControllerRateio:= TRateioController.Create;
  ControllerItensRateio := TItensRateioController.Create;
  MaskEdit1.Text := '';
  Edit1.Text := '';

  Edit4.Text := FloatTOStr(FormEmpresaTRab.areatotal);
  Edit5.Text := FloatToStr(FormEmpresaTRab.fundoreserva);
  Panel4.Visible :=false;
//  AtualizaGrid;
end;

end.
